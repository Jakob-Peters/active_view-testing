<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Unit Test</title>


    <script type="text/javascript">(function(){function i(e){if(!window.frames[e]){if(document.body&&document.body.firstChild){var t=document.body;var n=document.createElement("iframe");n.style.display="none";n.name=e;n.title=e;t.insertBefore(n,t.firstChild)}else{setTimeout(function(){i(e)},5)}}}function e(n,o,r,f,s){function e(e,t,n,i){if(typeof n!=="function"){return}if(!window[o]){window[o]=[]}var a=false;if(s){a=s(e,i,n)}if(!a){window[o].push({command:e,version:t,callback:n,parameter:i})}}e.stub=true;e.stubVersion=2;function t(i){if(!window[n]||window[n].stub!==true){return}if(!i.data){return}var a=typeof i.data==="string";var e;try{e=a?JSON.parse(i.data):i.data}catch(t){return}if(e[r]){var o=e[r];window[n](o.command,o.version,function(e,t){var n={};n[f]={returnValue:e,success:t,callId:o.callId};if(i.source){i.source.postMessage(a?JSON.stringify(n):n,"*")}},o.parameter)}}if(typeof window[n]!=="function"){window[n]=e;if(window.addEventListener){window.addEventListener("message",t,false)}else{window.attachEvent("onmessage",t)}}}e("__tcfapi","__tcfapiBuffer","__tcfapiCall","__tcfapiReturn");i("__tcfapiLocator")})();</script><script type="text/javascript">(function(){(function(e,r){var t=document.createElement("link");t.rel="preconnect";t.as="script";var n=document.createElement("link");n.rel="dns-prefetch";n.as="script";var i=document.createElement("script");i.id="spcloader";i.type="text/javascript";i["async"]=true;i.charset="utf-8";var o="https://sdk.privacy-center.org/"+e+"/loader.js?target_type=notice&target="+r;if(window.didomiConfig&&window.didomiConfig.user){var a=window.didomiConfig.user;var c=a.country;var d=a.region;if(c){o=o+"&country="+c;if(d){o=o+"&region="+d}}}t.href="https://sdk.privacy-center.org/";n.href="https://sdk.privacy-center.org/";i.src=o;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s);s.parentNode.insertBefore(n,s);s.parentNode.insertBefore(i,s)})("d0661bea-d696-4069-b308-11057215c4c4","KJ7YRD3N")})();</script>

    <!-- Assertive Yield Ad Setup -->
    <script src="https://sM2jrWhrfkRNS6Bjc.ay.delivery/manager/sM2jrWhrfkRNS6Bjc" type="text/javascript" referrerpolicy="no-referrer-when-downgrade" async></script>
    <script async="" type="text/javascript" src="https://macro.adnami.io/macro/gen/adsm.macro.rmb.js"></script>
    <!-- GPT.js Ad Setup -->
    <!-- 
    <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js" crossorigin="anonymous"></script>
    -->
    <script>
        window.googletag = window.googletag || { cmd: [] };

        let startTime = Date.now(); // Record when the script starts
        let lastEventTime = startTime; // Track the last event time for relative differences
        const eventLog = []; // Array to store all event details

        googletag.cmd.push(() => {
            googletag.pubads().setTargeting('yb_target', 'alwayson-adnamitest-topscroll');

            googletag
                .defineSlot("/21809957681/step/stepclient.dk/billboard_1", [930, 180], "div-gpt-ad-billboard_1_gpt")
                .addService(googletag.pubads());

            googletag.defineSlot("/21809957681/step/stepclient.dk/topscroll_desktop", [1, 2], "div-gpt-ad-topscroll_desktop_gpt")
                .addService(googletag.pubads());

            const logEventWithTimeline = (eventName, slotId) => {
                const currentTime = Date.now();
                const elapsedTime = currentTime - startTime; // Absolute time since the script started
                const timeDiff = currentTime - lastEventTime; // Relative time since the last event
                lastEventTime = currentTime; // Update last event time

                // Add event details to log
                eventLog.push({
                    Event: eventName,
                    "Slot ID": slotId || "N/A",
                    "Elapsed Time (ms)": elapsedTime,
                    "Time Since Last Event (ms)": timeDiff,
                });
            };

            googletag.pubads().addEventListener("slotRequested", (event) => {
                const slotId = event.slot.getSlotElementId();
                logEventWithTimeline("slotRequested", slotId);
            });

            googletag.pubads().addEventListener("impressionViewable", (event) => {
                const slotId = event.slot.getSlotElementId();
                logEventWithTimeline("impressionViewable", slotId);
            });

            googletag.pubads().addEventListener("slotRenderEnded", (event) => {
                const slotId = event.slot.getSlotElementId();
                logEventWithTimeline("slotRenderEnded", slotId);
            });

            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });

        // Tracking events to be used in console - For Adnami events
        window.addEventListener('message', (event) => {
            try {
                let data;

                if (typeof event.data === 'string') {
                    data = JSON.parse(event.data); // Attempt to parse JSON string data
                } else if (typeof event.data === 'object') {
                    data = event.data; // If event.data is already an object, use it directly
                }

                if (data) {
                    const currentTime = Date.now();
                    const elapsedTime = currentTime - startTime; // Absolute time since the script started
                    const timeDiff = currentTime - lastEventTime; // Relative time since the last event
                    lastEventTime = currentTime; // Update last event time

                    if (data.type === 'ADSM_RMB_ADS_INIT') {
                        const formatType = data.payload?.formatType || "Unknown";
                        eventLog.push({
                            Event: "ADSM_RMB_ADS_INIT",
                            "Slot ID": formatType,
                            "Elapsed Time (ms)": elapsedTime,
                            "Time Since Last Event (ms)": timeDiff,
                        });
                    } else if (data.type === 'adnm-bridge-track') {
                        const eventType = data.event || "Unknown";
                        eventLog.push({
                            Event: "adnm-bridge-track",
                            "Slot ID": eventType,
                            "Elapsed Time (ms)": elapsedTime,
                            "Time Since Last Event (ms)": timeDiff,
                        });
                    } else {
                        // No need to log non-matching events for now
                    }
                }
            } catch (e) {
                console.error('Error processing event data:', e, 'Raw data:', event.data);
            }
        });

        // Function to manually display the event log table
        window.showEventLog = () => {
            console.table(eventLog);
            console.log('Event log table displayed manually.');
        };

        // Display the complete event log as a table when the window unloads
        window.addEventListener("beforeunload", () => {
            console.table(eventLog);
        });
</script>

    


    <style>
        /* Button Styling */
        #GoogleButton {
        margin: 20px;
        text-align: center;
        }

        #bookmarklet-button {
        -webkit-box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.2),
            0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12);
        background: #4285f4;
        border-radius: 12px;
        box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14),
            0 1px 5px 0 rgba(0, 0, 0, 0.12);
        color: white;
        cursor: pointer;
        font-weight: bold;
        padding: 8px 15px;
        text-decoration: none;
        }

        /* Ad Container Layout */
        .container {
        display: flex;
        justify-content: space-around;
        }

        .ad-unit {
        width: 930px;
        height: 180px;
        border: 1px solid #ccc;
        margin: 10px;
        }

        /* Placeholder for Lazy Loading Test */
        .lazy-load-placeholder {
        height: 2000px;
        background-color: #f0f0f0;
        text-align: center;
        line-height: 2000px;
        color: #333;
        } 

        .topscroll_ad-unit {
            width: 100px;
            height: 100px;
            background-color: #f0f0f0;
            color: #333;
        }
    </style>
</head>
<body>
      <!-- Google Publisher Console Button -->
    
      <div id="GoogleButton">
        <a href="#" id="bookmarklet-button">Open Google Publisher Console</a>
        <script>
            document.getElementById('bookmarklet-button').addEventListener('click', function(event) {
                event.preventDefault();
                if (window.googletag && googletag.openConsole) {
                    googletag.openConsole();
                } else {
                    console.log("Google Publisher Console not available.");
                }
            });
        </script>
    </div>

    <div class="lazy-load-placeholder">
      Scroll down to view ad units
    </div>


    <div class="container">
        <!-- GPT.js Ad Unit -->
         <!-- 
        <div id="div-gpt-ad-billboard_1_gpt" class="ad-unit">
            <script>
                googletag.cmd.push(() => {
                    googletag.display("div-gpt-ad-billboard_1_gpt");
                });
            </script>
        </div> -->

        <!-- Assertive Yield Ad Unit -->
        <!-- 
        <div data-ay-manager-id="div-gpt-ad-billboard_1_test" class="ad-unit">
            <script type="text/javascript">
                window.ayManagerEnv = window.ayManagerEnv || { cmd: [] };
                window.ayManagerEnv.cmd.push(() => {
                    ayManagerEnv.display("div-gpt-ad-billboard_1_test");
                });
            </script>
        </div> -->
    </div>
    <!-- 
    <div data-ay-manager-id="div-gpt-ad-topscroll_desktop" class="topscroll_ad-unit">
        <script type="text/javascript">
            window.ayManagerEnv = window.ayManagerEnv || { cmd : []};
            window.ayManagerEnv.cmd.push(function() {
                ayManagerEnv.display("div-gpt-ad-topscroll_desktop");
            });
        </script>
    </div> -->
    <div id="div-gpt-ad-topscroll_desktop_gpt"></div>
        <script>
            googletag.cmd.push(() => {
                googletag.display("div-gpt-ad-topscroll_desktop_gpt");
            });
        </script>
    </div>

</body>
</html>
